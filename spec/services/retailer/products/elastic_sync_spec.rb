require 'rails_helper'

describe Retailer::Products::ElasticSync do

  describe '.index_structure' do
    let!(:shop) { create(:shop) }
    let!(:search_setting) { create(:search_setting, shop: shop, landing_page: 'http://ya.ru') }
    it 'ensures structure not changed' do
      expect(Retailer::Products::ElasticSync.new(shop).index_structure).to eq '{"settings":{"analysis":{"filter":{"shop_synonym_filter":{"type":"synonym","synonyms":[","]},"english_stemmer":{"type":"stemmer","language":"english"},"arabic_stemmer":{"type":"stemmer","language":"arabic"},"armenian_stemmer":{"type":"stemmer","language":"armenian"},"basque_stemmer":{"type":"stemmer","language":"basque"},"brazilian_stemmer":{"type":"stemmer","language":"brazilian"},"bulgarian_stemmer":{"type":"stemmer","language":"bulgarian"},"catalan_stemmer":{"type":"stemmer","language":"catalan"},"czech_stemmer":{"type":"stemmer","language":"czech"},"danish_stemmer":{"type":"stemmer","language":"danish"},"dutch_stemmer":{"type":"stemmer","language":"dutch"},"finnish_stemmer":{"type":"stemmer","language":"finnish"},"french_stemmer":{"type":"stemmer","language":"french"},"galician_stemmer":{"type":"stemmer","language":"galician"},"german_stemmer":{"type":"stemmer","language":"german"},"greek_stemmer":{"type":"stemmer","language":"greek"},"hindi_stemmer":{"type":"stemmer","language":"hindi"},"hungarian_stemmer":{"type":"stemmer","language":"hungarian"},"indonesian_stemmer":{"type":"stemmer","language":"indonesian"},"irish_stemmer":{"type":"stemmer","language":"irish"},"italian_stemmer":{"type":"stemmer","language":"italian"},"latvian_stemmer":{"type":"stemmer","language":"latvian"},"lithuanian_stemmer":{"type":"stemmer","language":"lithuanian"},"norwegian_stemmer":{"type":"stemmer","language":"norwegian"},"portuguese_stemmer":{"type":"stemmer","language":"portuguese"},"romanian_stemmer":{"type":"stemmer","language":"romanian"},"russian_stemmer":{"type":"stemmer","language":"russian"},"spanish_stemmer":{"type":"stemmer","language":"spanish"},"swedish_stemmer":{"type":"stemmer","language":"swedish"},"turkish_stemmer":{"type":"stemmer","language":"turkish"}},"analyzer":{"shop_synonyms":{"tokenizer":"standard","filter":["lowercase","shop_synonym_filter","english_stemmer"]}}}},"mappings":{"product":{"_all":{"enabled":false},"properties":{"widgetable":{"type":"boolean"},"name":{"type":"text","analyzer":"shop_synonyms"},"category_names":{"type":"text","analyzer":"shop_synonyms"},"suggest_product":{"type":"completion","contexts":[{"name":"widgetable","type":"category"}],"analyzer":"shop_synonyms"},"description":{"type":"text"},"price":{"type":"scaled_float","scaling_factor":100},"oldprice":{"type":"scaled_float","scaling_factor":100},"price_margin":{"type":"scaled_float","scaling_factor":100},"category_ids":{"type":"keyword"},"location_ids":{"type":"keyword"},"sales_rate":{"type":"scaled_float","scaling_factor":100},"brand":{"type":"keyword"},"picture":{"enabled":false},"url":{"enabled":false},"discount":{"type":"boolean"},"seasonality":{"type":"byte"},"leftovers":{"type":"keyword"},"uniqid":{"enabled":false},"type_prefix":{"type":"keyword"},"vendor_code":{"type":"keyword"},"model":{"type":"keyword"},"barcode":{"type":"keyword"},"is_fashion":{"type":"boolean"},"fashion_gender":{"type":"keyword"},"fashion_wear_type":{"type":"keyword"},"fashion_feature":{"type":"keyword"},"fashion_sizes":{"type":"integer"},"is_child":{"type":"boolean"},"child_gender":{"type":"keyword"},"child_type":{"type":"keyword"},"child_age_min":{"type":"scaled_float","scaling_factor":100},"child_age_max":{"type":"scaled_float","scaling_factor":100},"is_cosmetic":{"type":"boolean"},"cosmetic_gender":{"type":"keyword"},"cosmetic_hypoallergenic":{"type":"boolean"},"cosmetic_skin_part":{"type":"keyword"},"cosmetic_skin_type":{"type":"keyword"},"cosmetic_skin_condition":{"type":"keyword"},"cosmetic_hair_type":{"type":"keyword"},"cosmetic_hair_condition":{"type":"keyword"},"cosmetic_volume":{"type":"nested"},"cosmetic_periodic":{"type":"boolean"},"cosmetic_nail":{"type":"boolean"},"cosmetic_nail_type":{"type":"keyword"},"cosmetic_nail_color":{"type":"keyword"},"cosmetic_professional":{"type":"boolean"},"cosmetic_perfume_family":{"type":"keyword"},"cosmetic_perfume_aroma":{"type":"keyword"},"is_fmcg":{"type":"boolean"},"fmcg_hypoallergenic":{"type":"boolean"},"fmcg_volume":{"type":"nested"},"fmcg_periodic":{"type":"boolean"},"is_auto":{"type":"boolean"},"auto_compatibility":{"type":"nested"},"auto_periodic":{"type":"boolean"},"auto_vds":{"type":"keyword"},"is_pets":{"type":"boolean"},"pets_breed":{"type":"keyword"},"pets_type":{"type":"keyword"},"pets_age":{"type":"keyword"},"pets_periodic":{"type":"boolean"},"pets_size":{"type":"keyword"},"is_jewelry":{"type":"boolean"},"jewelry_gender":{"type":"keyword"},"jewelry_color":{"type":"keyword"},"jewelry_metal":{"type":"keyword"},"jewelry_gem":{"type":"keyword"},"ring_sizes":{"type":"keyword"},"bracelet_sizes":{"type":"keyword"},"chain_sizes":{"type":"keyword"},"is_realty":{"type":"boolean"},"realty_type":{"type":"keyword"},"realty_space_min":{"type":"scaled_float","scaling_factor":100},"realty_space_max":{"type":"scaled_float","scaling_factor":100},"realty_space_final":{"type":"scaled_float","scaling_factor":100}}},"category":{"_all":{"enabled":false},"properties":{"suggest_category":{"type":"completion"},"name":{"type":"text","analyzer":"shop_synonyms"},"url":{"enabled":false},"uniqid":{"enabled":false}}},"thematic_collection":{"properties":{"suggest_collection":{"type":"completion"},"name":{"type":"text","analyzer":"shop_synonyms"}}}}}'
    end
  end
end



